!function(t){"use strict";function e(t){if(this._value=s,this._status=r.PENDING,this._type=i,"function"==typeof t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)},function(t){e.notify(t)})}}function n(){this._promise=new e}var s,r={PENDING:0,FULFILLED:1,REJECTED:2},i="__ReadyPromise__",a=function(){var e=[],n=function(t){return e.push(t)-1},s=function(){var t=e,n=t.length,s=0;for(e=[];n>s;)t[s++]()};if("function"==typeof setImmediate)return function(t){n(t)||setImmediate(s)};if("object"==typeof process&&process.nextTick)return function(t){n(t)||process.nextTick(s)};if(t.postMessage){var r=!0,i=t.onmessage;if(t.onmessage=function(){r=!1},t.postMessage("","*"),t.onmessage=i,r){var a="__ready__"+(new Date).getTime(),c=function(t){t.data===a&&(t.stopPropagation&&t.stopPropagation(),s())};return t.addEventListener?t.addEventListener("message",c,!0):t.attachEvent("onmessage",c),function(e){n(e)||t.postMessage(a,"*")}}}return function(t){n(t)||setTimeout(s,0)}}();e.prototype={_addCallbacks:function(t,e,i){var a=new n,c={callback:"function"==typeof t?t:s,readyDefer:a};if(this._status===r.FULFILLED)return this._callCallbacks(c,this._value),a.promise();this._resolveStack?(this._resolveStack.length||(this._resolveStack=[this._resolveStack]),this._resolveStack.push(c)):this._resolveStack=c;var o={callback:"function"==typeof e?e:s,readyDefer:a};if(this._status===r.REJECTED)return this._callCallbacks(o,this._value),a.promise();this._rejectStack?(this._rejectStack.length||(this._rejectStack=[this._rejectStack]),this._rejectStack.push(o)):this._rejectStack=o;var u={callback:"function"==typeof i?i:s,readyDefer:a};return this._onMessage?(this._messageStack.length||(this._messageStack=[this._messageStack]),this._messageStack.push(u)):this._messageStack=u,a.promise()},then:function(t,e,n){return this._addCallbacks(t,e,n)},done:function(t){return this._addCallbacks(t)},fail:function(t){return this._addCallbacks(s,t)},notify:function(t){return this._addCallbacks(s,s,t)},"catch":function(t){return this._addCallbacks(s,t)},_resolve:function(t){if(!(this._status>0)){if(t===this&&this._reject(new TypeError("Can't resolve promise with itself")),t&&("object"==typeof t||"function"==typeof t)){if(t._type&&t._type===i)return void(t._status===r.FULFILLED?this._resolve(t._value):t._status===r.REJECTED?this._reject(t._value):t.then(this._resolve.bind(this),this._reject.bind(this)));var e;try{e=t.then}catch(n){return void this._reject(n)}if("function"==typeof e){var a=this,c=!1;try{e.call(t,function(t){c||(c=!0,a._resolve(t))},function(t){c||(c=!0,a._reject(t))})}catch(n){c||this._reject(n)}return}}this._value=t,this._status=r.FULFILLED,this._callCallbacks(this._resolveStack,t),this._resolveStack=s,this._rejectStack=s}},_reject:function(t){this._status>0||(this._value=t,this._status=r.REJECTED,this._callCallbacks(this._rejectStack,t),this._resolveStack=s,this._rejectStack=s)},_notify:function(t){this._callCallbacks(this._messageStack,t)},_callCallbacks:function(t,e){var n=function(t){var n=e;if(t.callback)try{var r=t.callback;n=r(e)}catch(i){return void t.readyDefer.reject(i)}else t.readyDefer[s](n);t.readyDefer.resolve(n)},s=this._status===r.FULFILLED?"resolve":"reject";t&&a(function(){if(!t.length)return void n(t);for(var e=t.length,s=0;e>s;s++)n(t[s])})},constructor:e},n.prototype={promise:function(){return this._promise},resolve:function(t){this._promise._resolve(t)},reject:function(t){this._promise._reject(t)},notify:function(t){this._promise._notify(t)},constructor:n};var c={Promise:e,Deffered:n,defer:function(){return new n},all:function(t){var e=function(e){t[e].then(function(t){r[e]=t,s--,0===s&&i.resolve(r)},function(t){i.reject(t)})},s=0,r=[],i=new n;for(var a in t)s++,e(a);return i.promise()},race:function(t){var e=function(e){t[e].then(function(t){s.resolve(t)},function(t){s.reject(t)})},s=new n;for(var r in t)e(r);return s.promise()},spead:function(){for(var t=function(t,n){t.then(function(t){s[n]=t,e--,0===e&&r.resolve(s)},function(t){r.reject(t)})},e=0,s=[],r=new n,i=0,a=arguments.length;a>i;i++)e++,t(arguments[i],i);return r.promise()},any:function(t){var e=0,s=[],r=new n;for(var i in t)e++,function(n){t[n].then(function(t){var e={};e[n]=t,r.resolve(e)},function(t){s[n]=t,e--,0===e&&r.reject(s)})}(i);return r.promise()},resolve:function(t){var e=new n;return e.resolve(t),e.promise()},reject:function(t){var e=new n;return e.reject(t),e.promise()}};!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e:t.ready=e}(c)}(this);