!function(t){"use strict";function e(t){if(this._value=r,this._status=i.PENDING,this._type=o,this._resolveStack=[],this._rejectStack=[],t){var e=this;t(function(t){e._resolve(t)},function(t){e._reject(t)})}}function n(){this._promise=new e}var r,i={PENDING:0,FULFILLED:1,REJECTED:2},o="__ReadyPromise__",s=function(){var e=[],n=function(t){return e.push(t)-1},r=function(){var t=e,n=t.length,r=0;for(e=[];n>r;)t[r++]()};if("function"==typeof setImmediate)return function(t){n(t)||setImmediate(r)};if("object"==typeof process&&process.nextTick)return function(t){n(t)||process.nextTick(r)};if(t.postMessage){var i=!0,o=t.onmessage;if(t.onmessage=function(){i=!1},t.postMessage("","*"),t.onmessage=o,i){var s="__ready__"+(new Date).getTime(),c=function(t){t.data===s&&(t.stopPropagation&&t.stopPropagation(),r())};return t.addEventListener?t.addEventListener("message",c,!0):t.attachEvent("onmessage",c),function(e){n(e)||t.postMessage(s,"*")}}}return function(t){n(t)||setTimeout(r,0)}}();e.prototype={_addCallbacks:function(t,n){var o,s,c=new e(function(t,e){o=t,s=e}),a={callback:"function"==typeof t?t:r,resolve:o,reject:s};if(this._status===i.FULFILLED)return this._callCallbacks([a],this._value),c;this._resolveStack.push(a);var u={callback:"function"==typeof n?n:r,resolve:o,reject:s};return this._status===i.REJECTED?(this._callCallbacks([u],this._value),c):(this._rejectStack.push(u),c)},then:function(t,e){return this._addCallbacks(t,e)},done:function(t){return this._addCallbacks(t)},fail:function(t){return this._addCallbacks(r,t)},"catch":function(t){return this._addCallbacks(r,t)},nodeify:function(t,e){return"function"!=typeof t?this:void this.then(function(n){t.call(e,null,n)},function(n){t.call(e,n)})},_resolve:function(t){if(!(this._status>0)){if(t===this&&this._reject(new TypeError("Can't resolve promise with itself")),t&&("object"==typeof t||"function"==typeof t)){if(t._type&&t._type===o)return void(t._status===i.FULFILLED?this._resolve(t._value):t._status===i.REJECTED?this._reject(t._value):t.then(this._resolve.bind(this),this._reject.bind(this)));var e;try{e=t.then}catch(n){return void this._reject(n)}if("function"==typeof e){var r=this,s=!1;try{e.call(t,function(t){s||(s=!0,r._resolve(t))},function(t){s||(s=!0,r._reject(t))})}catch(n){s||this._reject(n)}return}}this._value=t,this._status=i.FULFILLED,this._callCallbacks(this._resolveStack,t),this._resolveStack=[],this._rejectStack=[]}},_reject:function(t){this._status>0||(this._value=t,this._status=i.REJECTED,this._callCallbacks(this._rejectStack,t),this._resolveStack=[],this._rejectStack=[])},_callCallbacks:function(t,e){var n=function(t){var n=e;if(!t.callback)return void t[r](n);try{var i=t.callback;n=i(e)}catch(o){return void t.reject(o)}t.resolve(n)},r=this._status===i.FULFILLED?"resolve":"reject";t&&t.length&&s(function(){for(var e=t.length,r=0;e>r;r++)n(t[r])})},constructor:e},e.all=function(t){var e,r=function(e){t[e].then(function(t){o[e]=t,i--,0===i&&s.resolve(o)},function(t){s.reject(t)})},i=0,o=[],s=new n;if(t instanceof Array)for(e=0;e<t.length;e++)i++,r(e);else for(e in t)i++,r(e);return s.promise()},e.race=function(t){var e,r=function(e){t[e].then(function(t){i.resolve(t)},function(t){i.reject(t)})},i=new n;if(t instanceof Array)for(e=0;e<t.length;e++)r(e);else for(var e in t)r(e);return i.promise()},e.resolve=function(t){return new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},n.prototype={promise:function(){return this._promise},resolve:function(t){this._promise._resolve(t)},reject:function(t){this._promise._reject(t)},constructor:n};var c={Promise:e,Deffered:n,defer:function(){return new n},all:e.all,race:e.race,spead:function(){for(var t=function(t,n){t.then(function(t){r[n]=t,e--,0===e&&i.resolve(r)},function(t){i.reject(t)})},e=0,r=[],i=new n,o=0,s=arguments.length;s>o;o++)e++,t(arguments[o],o);return i.promise()},any:function(t){var e=0,r=[],i=new n;for(var o in t)e++,function(n){t[n].then(function(t){var e={};e[n]=t,i.resolve(e)},function(t){r[n]=t,e--,0===e&&i.reject(r)})}(o);return i.promise()},resolve:e.resolve,reject:e.reject,denodeify:function(t,e){return e=e||1/0,function(){for(var n=this,r=Array.prototype.slice.call(arguments),i=this.defer();r.length&&r.length>e;)r.pop();r.push(function(t,e){t?i.reject(t):i.resolve(e)});var o=t.apply(n,r);return!o||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then||i.resolve(o),i.promise()}},polyfill:function(n){if(!n){var r=window||t;if(r.Promise&&-1!==r.Promise.toString().indexOf("[native code]"))return}window?window.Promise=e:t.Promise=e}};!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e:t.ready=e}(c)}(this);