!function(t){"use strict";function e(t){if(this._value=r,this._status=i.PENDING,this._type=s,this._resolveStack=[],this._rejectStack=[],"function"==typeof t){var e=this;t(function(t){e.resolve(t)},function(t){e.reject(t)})}}function n(){this._promise=new e}var r,i={PENDING:0,FULFILLED:1,REJECTED:2},s="__ReadyPromise__",o=function(){var e=[],n=function(t){return e.push(t)-1},r=function(){var t=e,n=t.length,r=0;for(e=[];n>r;)t[r++]()};if("function"==typeof setImmediate)return function(t){n(t)||setImmediate(r)};if("object"==typeof process&&process.nextTick)return function(t){n(t)||process.nextTick(r)};if(t.postMessage){var i=!0,s=t.onmessage;if(t.onmessage=function(){i=!1},t.postMessage("","*"),t.onmessage=s,i){var o="__ready__"+(new Date).getTime(),c=function(t){t.data===o&&(t.stopPropagation&&t.stopPropagation(),r())};return t.addEventListener?t.addEventListener("message",c,!0):t.attachEvent("onmessage",c),function(e){n(e)||t.postMessage(o,"*")}}}return function(t){n(t)||setTimeout(r,0)}}();e.prototype={_addCallbacks:function(t,e){var s=new n,o={callback:"function"==typeof t?t:r,readyDefer:s};if(this._status===i.FULFILLED)return this._callCallbacks([o],this._value),s.promise();this._resolveStack.push(o);var c={callback:"function"==typeof e?e:r,readyDefer:s};return this._status===i.REJECTED?(this._callCallbacks([c],this._value),s.promise()):(this._rejectStack.push(c),s.promise())},then:function(t,e){return this._addCallbacks(t,e)},done:function(t){return this._addCallbacks(t)},fail:function(t){return this._addCallbacks(r,t)},"catch":function(t){return this._addCallbacks(r,t)},nodeify:function(t,e){return"function"!=typeof t?this:void this.then(function(n){t.call(e,null,n)},function(n){t.call(e,n)})},_resolve:function(t){if(!(this._status>0)){if(t===this&&this._reject(new TypeError("Can't resolve promise with itself")),t&&("object"==typeof t||"function"==typeof t)){if(t._type&&t._type===s)return void(t._status===i.FULFILLED?this._resolve(t._value):t._status===i.REJECTED?this._reject(t._value):t.then(this._resolve.bind(this),this._reject.bind(this)));var e;try{e=t.then}catch(n){return void this._reject(n)}if("function"==typeof e){var r=this,o=!1;try{e.call(t,function(t){o||(o=!0,r._resolve(t))},function(t){o||(o=!0,r._reject(t))})}catch(n){o||this._reject(n)}return}}this._value=t,this._status=i.FULFILLED,this._callCallbacks(this._resolveStack,t),this._resolveStack=[],this._rejectStack=[]}},_reject:function(t){this._status>0||(this._value=t,this._status=i.REJECTED,this._callCallbacks(this._rejectStack,t),this._resolveStack=[],this._rejectStack=[])},_callCallbacks:function(t,e){var n=function(t){var n=e;if(!t.callback)return void t.readyDefer[r](n);try{var i=t.callback;n=i(e)}catch(s){return void t.readyDefer.reject(s)}t.readyDefer.resolve(n)},r=this._status===i.FULFILLED?"resolve":"reject";t&&t.length&&o(function(){for(var e=t.length,r=0;e>r;r++)n(t[r])})},constructor:e},n.prototype={promise:function(){return this._promise},resolve:function(t){this._promise._resolve(t)},reject:function(t){this._promise._reject(t)},constructor:n};var c={Promise:e,Deffered:n,defer:function(){return new n},all:function(t){var e=function(e){t[e].then(function(t){i[e]=t,r--,0===r&&s.resolve(i)},function(t){s.reject(t)})},r=0,i=[],s=new n;for(var o in t)r++,e(o);return s.promise()},race:function(t){var e=function(e){t[e].then(function(t){r.resolve(t)},function(t){r.reject(t)})},r=new n;for(var i in t)e(i);return r.promise()},spead:function(){for(var t=function(t,n){t.then(function(t){r[n]=t,e--,0===e&&i.resolve(r)},function(t){i.reject(t)})},e=0,r=[],i=new n,s=0,o=arguments.length;o>s;s++)e++,t(arguments[s],s);return i.promise()},any:function(t){var e=0,r=[],i=new n;for(var s in t)e++,function(n){t[n].then(function(t){var e={};e[n]=t,i.resolve(e)},function(t){r[n]=t,e--,0===e&&i.reject(r)})}(s);return i.promise()},resolve:function(t){var e=new n;return e.resolve(t),e.promise()},reject:function(t){var e=new n;return e.reject(t),e.promise()},denodeify:function(t,e){return e=e||1/0,function(){for(var n=this,r=Array.prototype.slice.call(arguments),i=this.defer();r.length&&r.length>e;)r.pop();r.push(function(t,e){t?i.reject(t):i.resolve(e)});var s=t.apply(n,r);return!s||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof s.then||i.resolve(s),i.promise()}}};!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e:t.ready=e}(c)}(this);